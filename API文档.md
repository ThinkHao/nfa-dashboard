# NFA-Dashboard 后端 API 文档

## 基本信息

- 基础URL: `http://localhost:8081`
- 所有接口返回格式统一为 JSON
- 通用返回格式:

```json
{
  "code": 200,       // 状态码，200表示成功，其他表示失败
  "message": "成功",  // 状态描述
  "data": {}         // 返回数据，可能是对象、数组或null
}
```

## 接口列表

### 1. 获取学校列表

获取所有学校的基本信息，支持分页和过滤。

- **URL**: `/api/v1/schools`
- **方法**: `GET`
- **参数**:

| 参数名 | 类型 | 必填 | 描述 |
|-------|-----|------|------|
| school_name | string | 否 | 学校名称，支持模糊查询 |
| region | string | 否 | 地区名称，精确匹配 |
| cp | string | 否 | 运营商名称，精确匹配 |
| limit | int | 否 | 返回数量限制，默认100 |
| offset | int | 否 | 分页偏移量，默认0 |

- **返回示例**:

```json
{
  "code": 200,
  "message": "获取学校列表成功",
  "data": {
    "total": 1000,
    "schools": [
      {
        "id": 1,
        "school_id": "1000",
        "school_name": "厦门大学",
        "region": "福建省",
        "cp": "bilibili",
        "hash_uuids": "uuid1,uuid2",
        "primary_hash_uuid": "uuid1",
        "hash_count": 2,
        "update_time": "2025-05-07T12:00:00+08:00",
        "data_hash": "hash_value"
      }
    ]
  }
}
```

### 2. 获取地区列表

获取所有地区的列表。

- **URL**: `/api/v1/regions`
- **方法**: `GET`
- **参数**: 无
- **返回示例**:

```json
{
  "code": 200,
  "message": "获取地区列表成功",
  "data": [
    "北京市",
    "上海市",
    "福建省",
    "广东省"
  ]
}
```

### 3. 获取运营商列表

获取所有运营商的列表。

- **URL**: `/api/v1/cps`
- **方法**: `GET`
- **参数**: 无
- **返回示例**:

```json
{
  "code": 200,
  "message": "获取运营商列表成功",
  "data": [
    "bilibili",
    "tencent",
    "alibaba",
    "baidu"
  ]
}
```

### 4. 获取流量数据

根据过滤条件获取学校流量数据。

- **URL**: `/api/v1/traffic`
- **方法**: `GET`
- **参数**:

| 参数名 | 类型 | 必填 | 描述 |
|-------|-----|------|------|
| start_time | string | 否 | 开始时间，格式：2025-05-07T00:00:00+08:00 |
| end_time | string | 否 | 结束时间，格式：2025-05-07T23:59:59+08:00 |
| school_name | string | 否 | 学校名称，支持模糊查询 |
| region | string | 否 | 地区名称，精确匹配 |
| cp | string | 否 | 运营商名称，精确匹配 |
| interval | string | 否 | 时间间隔：hour(小时)、day(天)、week(周)、month(月)，默认hour |
| limit | int | 否 | 返回数量限制，默认100 |
| offset | int | 否 | 分页偏移量，默认0 |

- **返回示例**:

```json
{
  "code": 200,
  "message": "获取流量数据成功",
  "data": [
    {
      "create_time": "2025-05-07T17:10:00+08:00",
      "school_id": "1000",
      "school_name": "厦门大学",
      "region": "福建省",
      "cp": "bilibili",
      "total_recv": 5252116000,
      "total_send": 94356000,
      "total": 5346472000
    }
  ]
}
```

### 5. 获取流量汇总数据

获取符合条件的流量汇总数据。

- **URL**: `/api/v1/traffic/summary`
- **方法**: `GET`
- **参数**:

| 参数名 | 类型 | 必填 | 描述 |
|-------|-----|------|------|
| start_time | string | 否 | 开始时间，格式：2025-05-07T00:00:00+08:00 |
| end_time | string | 否 | 结束时间，格式：2025-05-07T23:59:59+08:00 |
| school_name | string | 否 | 学校名称，支持模糊查询 |
| region | string | 否 | 地区名称，精确匹配 |
| cp | string | 否 | 运营商名称，精确匹配 |

- **返回示例**:

```json
{
  "code": 200,
  "message": "获取流量汇总数据成功",
  "data": {
    "total_recv": 15930176000,
    "total_send": 261320000,
    "total": 16191496000
  }
}
```

## 错误码说明

| 错误码 | 描述 |
|-------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

## 注意事项

1. 时间相关参数如果不提供，系统会自动使用默认值：
   - 如果未提供开始时间和结束时间，默认查询最近1天的数据
   - 如果只提供开始时间，结束时间默认为当前时间
   - 如果只提供结束时间，开始时间默认为结束时间前1天

2. 流量数据查询最多返回过去3天的数据，即使请求的时间范围更大

3. 所有流量数据单位均为字节(Byte)

4. 时间间隔(interval)参数会影响返回数据的聚合方式：
   - hour: 按小时聚合
   - day: 按天聚合
   - week: 按周聚合
   - month: 按月聚合
